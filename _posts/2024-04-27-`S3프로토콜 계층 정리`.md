---
title: "testPosts.md file"
categories:
  - Post Formats
tags:
  - Post Formats
  - readableility
  - standard
toc: true
toc_sticky: true
---

# S1 : Service Discovery

Written By [Ajeong Joo](https://github.com/ajung7038)

## Spring Cloud Netflix Eureka

- 서버가 같으면 포트를 다르게, 서버가 다르면 포트를 같게 해도 상관없다

### Service Discovery

- 서비스 클라이언트가 서비스를 호출할 때 서비스의 위치 (IP 주소와 포트)를 알아낼 수 있는 기능
- 클라우드 환경이 되며 서비스가 오토 스케일링 등에 의해 동적으로 생성되거나 컨테이너 기반의 배포로 인해 서비스의 IP가 동적으로 변경되는 일이 잦아졌기 때문
  ![image](https://github.com/APPS-sookmyung/2023-2-SpringCloud-Study/assets/80907516/9c78d339-6bf3-4a21-a91e-2d6cf0533761)

### yml 파일 설정

- application.yml
- eureka : 유레카 설정 파일
- `register-with-eureka` 와 `fetch-registry` 를 false로 설정해두지 않으면 자신의 정보를 자신에게 등록하는 의미 없는 작업을 하게 된다.

## 프로젝트 생성

### 스프링부트 버전 변경

- 사유 : Netflix Zuul 실습을 완만하게 따라하기 위함

### pom.xml 파일 변경 사항

- 2.7.16 -> 2.4.2 버전으로 변경 (스프링부트, 8번째 줄)
- 2021.0.8 -> 2020.0.0으로 변경 (스프링 클라우드, 18번째 줄)
- 17 -> 11 (자바 버전 변경, 17번째 줄)
- 근데 오류 나서 다시 2.7.16 버전 사용 중...

</br>
- EnableEurekaClient vs EnableDiscoveryClient
- 디스커버리 클라이언트를 구현해서 상품화 시켜 놓은 것을 유레카라고 봄

## User Service - 등록

1. 오른쪽 위 상단에 UserServiceApplication 클릭

![image](https://github.com/APPS-sookmyung/2023-2-SpringCloud-Study/assets/80907516/441dbef4-ec5b-4023-b88d-cddc16d7e29e)

2. Edit Configurations... 클릭

![image](https://github.com/APPS-sookmyung/2023-2-SpringCloud-Study/assets/80907516/17d1294d-d19b-4a8d-a182-98e79941ab71)

3. 오른쪽 위 추가 또는 복사 누르기
   -> ※ 복사 후 그냥 실행 시 포트 번호가 겹치므로 주의해야 한다

- yml 파일에 서버 포트 값을 직접적으로 바꾸게 되면 매번 다시 빌드 및 배포를 해야 하므로 직접 하드 코드를 바꾸는 것은 의미가 없다

![image](https://github.com/APPS-sookmyung/2023-2-SpringCloud-Study/assets/80907516/82838115-5ce8-43eb-ab0c-5a83aaa4dadf)

4. 숨어있는 VM options 찾기
   -> Modify options -> Add VM options 해야 보인다

![image](https://github.com/APPS-sookmyung/2023-2-SpringCloud-Study/assets/80907516/1350ffda-8643-4473-aff0-aab33cdfffef)

5. -Dserver.port=포트번호 : 포트번호 지정
   -> 서버를 기동할 때 부가적인 파라미터를 전달함으로써 동적으로 변경될 수 있는 서버 포트 지정

### 이 또한 지나가리라

그리고 또 발생하는 문제... Intellij 터미널로 서버 동시 가동 중 문제가 발생했다.

1. `java -jar -Dserver.port=9004 ./target/user-service-0.0.1-SNAPSHOT.jar` 입력

- `Error: Unable to access jarfile .port=9004` 에러 발생
  터미널 포기할까...

2. java -jar '-Dserver.port=9004' .\target\user-service-0.0.1-SNAPSHOT.jar

- `Error: Unable to access jarfile .\target\user-service-0.0.1-SNAPSHOT.jar` 에러 발생

-> 사실 못 고쳤습니다. 방법을 아신다면 알려주세요... (모든 방법 실패)
-> cmd 창 열고 치고 있습니다.

## User Service - Load Balancer

- 매번 포트를 지정해 주는 불편함을 최소화하기 위해 스프링에서 지원해 주는 랜덤 포트 방법을 사용할 수 있다

### 사용 방법

- yml 파일의 포트 번호를 `0`으로 지정해 준다
- 기존에 지정했던 포트 번호는 삭제해야 한다

### 사용

1. 인스턴스 아이디 할당

> instance-id: ${spring.cloud.client.hostname}:${spring.application.instance_id:${random.value}}

2. cmd 창에 `mvn spring-boot:run` 입력 (target 파일이 있는 곳으로 이동 후 명령어 처리)

## 참고 자료

- https://ryumodrn.tistory.com/9
- https://bcho.tistory.com/1252
