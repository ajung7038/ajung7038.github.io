---
title: "[Java] Item 13 : clone ì¬ì •ì˜ëŠ” ì£¼ì˜í•´ì„œ ì§„í–‰í•˜ë¼
categories:
  - Effective Java
tags:
toc: true
toc_sticky: true
date: 2024-10-01 22:01:00 +0900
---

<strong>Effective Javaë¥¼ ì½ê³  ì •ë¦¬í•œ ì •ë¦¬ë³¸ì…ë‹ˆë‹¤.</strong>
{: .notice}

# ğŸ“Œ Item 13 : clone ì¬ì •ì˜ëŠ” ì£¼ì˜í•´ì„œ ì§„í–‰í•˜ë¼

## ğŸ«§ Cloneable

Object.clone() ë©”ì„œë“œëŠ” ì¸ìŠ¤í„´ìŠ¤ ê°ì²´ë¥¼ ë³µì œí•˜ëŠ” ê²½ìš° ì‚¬ìš©ëœë‹¤.

ì´ ë©”ì„œë“œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ protected ì ‘ê·¼ ê¶Œí•œì„ ê°–ê³  ìˆê¸° ë•Œë¬¸ì— ì‚¬ìš©í•˜ëŠ” ê²½ìš° publicìœ¼ë¡œ ì¬ì •ì˜í•˜ì—¬ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

ì´ë•Œ ë°ì´í„° ë³´í˜¸ë¥¼ ì´ìœ ë¡œ Cloneable ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„ í•´ì•¼ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë‹¤.

### âœ¨ ì½”ë“œ

```java
package java.lang;
public interface Cloneable {
}
```

ë†€ëê²Œë„ ì´ê²Œ ëì´ë‹¤.

ëŒ€ê°œ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œë‹¤ëŠ” ê²ƒì€ í•´ë‹¹ í´ë˜ìŠ¤ê°€ ê·¸ ì¸í„°í˜ì´ìŠ¤ì—ì„œ ì •ì˜í•œ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤ê³  ì„ ì–¸í•˜ëŠ” í–‰ìœ„ì´ë‹¤.

ê·¸ëŸ¬ë‚˜ CloneableëŠ” ë©”ì„œë“œ í•˜ë‚˜ ì—†ì´ ì˜¤ë¡œì§€ ê»ë°ê¸°ë§Œ ë“¤ì–´ ìˆë‹¤. ê¸°ëŠ¥ ì œê³µë³´ë‹¤ëŠ” ìƒìœ„ í´ë˜ìŠ¤ì— ì •ì˜ëœ protected ë©”ì„œë“œì˜ "ë™ì‘ ë°©ì‹ ë³€ê²½"ì— ì´ˆì ì„ ë§ì·„ê¸° ë•Œë¬¸ì´ë‹¤.

Object.clone() ë©”ì„œë“œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ protected ì ‘ê·¼ ê¶Œí•œì„ ê°–ê³  ìˆê¸° ë•Œë¬¸ì—, Cloneable ë©”ì„œë“œë¥¼ í†µí•´ protected -> publicìœ¼ë¡œ ë™ì‘ ë°©ì‹ì„ ë³€ê²½í•˜ëŠ” ê²ƒì´ë‹¤.

### âœ¨ ë™ì‘ ë°©ì‹

Cloneableì„ êµ¬í˜„í•œ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ì—ì„œ cloneì„ í˜¸ì¶œí•˜ë©´ ê·¸ ê°ì²´ì˜ í•„ë“œë“¤ì„ í•˜ë‚˜í•˜ë‚˜ ë³µì‚¬í•œ ê°ì²´ë¥¼ ë°˜í™˜í•˜ë©°, ê·¸ë ‡ì§€ ì•Šì€ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ì—ì„œ í˜¸ì¶œí•˜ë©´ CloneNotSupportedException ì˜ˆì™¸ë¥¼ ë˜ì§„ë‹¤.

ì‹¤ë¬´ì—ì„œ Cloneableì„ êµ¬í˜„í•œ í´ë˜ìŠ¤ëŠ” clone ë©”ì„œë“œë¥¼ publicìœ¼ë¡œ ì œê³µí•˜ë©°, ì‚¬ìš©ìëŠ” ë‹¹ì—°íˆ ë³µì œê°€ ì œëŒ€ë¡œ ì´ë¤„ì§€ë¦¬ë¼ ê¸°ëŒ€í•œë‹¤. ê·¸ëŸ¬ë‚˜ ì´ë¥¼ ë§Œì¡±ì‹œí‚¤ê¸° ìœ„í•´ì„œëŠ” í—ˆìˆ í•œ í”„ë¡œí† ì½œì„ ì§€ì¼œì•¼ í•œë‹¤.

ì‹¤ì œë¡œë„ clone ë©”ì„œë“œ ì¼ë°˜ ê·œì•½ì€ í—ˆìˆ í•˜ë‹¤.

## ğŸ«§ Clone ë©”ì„œë“œ ì¼ë°˜ ê·œì•½

: ì´ ê°ì²´ì˜ ë³µì‚¬ë³¸ì„ ìƒì„±í•´ ë°˜í™˜í•œë‹¤. 'ë³µì‚¬'ì˜ ì •í™•í•œ ëœ»ì€ ê·¸ ê°ì²´ë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤ì— ë”°ë¼ ë‹¤ë¥¼ ìˆ˜ ìˆë‹¤. ì¼ë°˜ì ì¸ ì˜ë„ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤. ì–´ë˜ ê°ì²´ xì— ëŒ€í•´ ë‹¤ìŒ ì‹ì€ ì°¸ì´ë‹¤.

1) x.clone() != x

    -> ì¸ìŠ¤í„´ìŠ¤ê°€ ë‹¤ë¥´ë¯€ë¡œ ì›ë³¸ê°’ê³¼ cloneëœ ì¸ìŠ¤í„´ìŠ¤ëŠ” ë‹¤ë¥¸ ê°ì²´ì´ë‹¤.

2) x.clone().getClass() == x.getClass()

    -> cloneí•œ ê°ì²´ì˜ í´ë˜ìŠ¤ íƒ€ì…ê³¼ ì›ë³¸ í´ë˜ìŠ¤ íƒ€ì…ì€ ë™ì¼í•˜ë‹¤.

3) x.clone().equals(x)

    -> ë…¼ë¦¬ì  ë™ì¹˜ë¥¼ ëœ»í•œë‹¤. xì˜ ë‚´ìš© (ë‹¤ë¥¸ ì¸ìŠ¤í„´ìŠ¤ì— ë˜‘ê°™ì€ ê°’ì„ í¸ì˜ìƒ ë‚´ìš©ì´ë¼ ì§€ì¹­) ê³¼ cloneëœ ì¸ìŠ¤í„´ìŠ¤ì˜ ë‚´ìš©ì´ ê°™ë‹¤.

    -> ì´ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ì°¸ì´ì§€ë§Œ, í•„ìˆ˜ëŠ” ì•„ë‹ˆë‹¤.

4) x.clone().getClass() == x.getClass()


ê°•ì œì„±ì´ ì—†ë‹¤ëŠ” ì ë§Œ ë¹¼ë©´ ìƒì„±ì ì—°ì‡„ì™€ ì‚´ì§ ë¹„ìŠ·í•˜ë‹¤.

ì´ëŸ¬í•œ clone ê·œì•½ì´ í—ˆìˆ í•œ ì´ìœ ëŠ” ë°”ë¡œ ë‹¤ìŒ ë¬¸ì œì— ë“œëŸ¬ë‚œë‹¤.

ë§Œì•½ clone ë©”ì„œë“œ í˜¸ì¶œì´ ì•„ë‹Œ ìƒì„±ìë¥¼ í˜¸ì¶œí•´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì–»ëŠ”ë‹¤ê³  í•˜ë”ë¼ë„ ì»´íŒŒì¼ëŸ¬ì—ì„œ ë¬¸ì œë¥¼ ì¡ì•„ë‚¼ ìˆ˜ ì—†ë‹¤. clone ê·œì•½ì„ ì–´ê¸°ì§€ ì•Šê³  ìƒì„±ìë¥¼ í†µí•´ 'ë³µì‚¬'í–ˆê¸° ë•Œë¬¸ì´ë‹¤.

ê·¸ëŸ¬ë‚˜ ì´ í´ë˜ìŠ¤ì˜ í•˜ìœ„ í´ë˜ìŠ¤ì—ì„œ super.cloneì„ í˜¸ì¶œí•˜ëŠ” ìˆœê°„ ë¬¸ì œê°€ ë°œìƒí•œë‹¤. ìƒìœ„ í´ë˜ìŠ¤ëŠ” clone ì¬ì •ì˜ê°€ ì•„ë‹Œ ìƒì„±ìë¥¼ í˜¸ì¶œí–ˆê¸° ë•Œë¬¸ì´ë‹¤. ê²°êµ­ í•˜ìœ„ í´ë˜ìŠ¤ì˜ íƒ€ì…ì€ ìƒìœ„ í´ë˜ìŠ¤ê°€ ì•„ë‹Œ ìƒìœ„ í´ë˜ìŠ¤ì˜ ìƒìœ„ í´ë˜ìŠ¤ íƒ€ì…ì„ ë°˜í™˜í•˜ê²Œ ë  ê²ƒì´ë‹¤. (ë§Œì•½ ìƒìœ„ í´ë˜ìŠ¤ íƒ€ì…ì˜ ìƒìœ„ í´ë˜ìŠ¤ íƒ€ì…ì´ clone()ì„ ì¬ì •ì˜í–ˆë‹¤ë©´)

## ğŸ«§ Cloneable êµ¬í˜„

Cloneable êµ¬í˜„ì€ í¬ê²Œ ë‘ ê°€ì§€ë¡œ ë‚˜ë‰œë‹¤.

1) ê¸°ë³¸ íƒ€ì… or ë¶ˆë³€ ê°ì²´ ì°¸ì¡°
2) ê°€ë³€ ê°ì²´ ì°¸ì¡°

### âœ¨ ê¸°ë³¸ íƒ€ì… or ë¶ˆë³€ ê°ì²´ ì°¸ì¡°

```java
@Override public PhoneNumber clone() {
    try {
        return (PhoneNumber) super.clone();
    } catch (CloneNotSupportedException e) {
        throw new AssertonError();
    }
}
```

- ì¬ì •ì˜í•œ ë©”ì„œë“œì˜ ë°˜í™˜ íƒ€ì…ì€ ìƒìœ„ í´ë˜ìŠ¤ì˜ ë©”ì„œë“œê°€ ë°˜í™˜í•˜ëŠ” íƒ€ì…ì˜ í•˜ìœ„ íƒ€ì…ìœ¼ë¡œ ë°˜í™˜ë  ìˆ˜ ìˆë„ë¡ êµ¬í˜„ í•´ì•¼ í•œë‹¤.

    -> ìë°”ì˜ ê³µë³€ ë°˜í™˜ íƒ€ì´í•‘
    
#### ğŸ’¡ (PhoneNumber) super.clone(); ì²˜ëŸ¼ í˜• ë³€í™˜ì„ ìë™ìœ¼ë¡œ í•´ ì£¼ì

### âœ¨ ê°€ë³€ ê°ì²´ ì°¸ì¡°

```java
public class Stack {
    private Object[] elements;
    private int size = 0;
    private static final int DEFAULT_INITIAL_CAPACITY = 16;

    public Stack() {
        this.elements = new Object[DEFAULT_INITIAL_CAPACITY];
    }

    public void push(Object e) {
        ensureCapacity();
        elements[size++] = e;
    }

    public Object pop() {
        if (sie == 0)
            throw new EmpthStackException();
        Object result = elements[--size];
        elements[size] = null; // ë‹¤ ì“´ ì°¸ì¡° í•´ì œ
        return result;
    }

    private void ensureCapacity() {
        if (elements.length == size)
            elements = Arrays.copyOf(elements, 2 * size + 1);
    }
}
```

ì´ëŸ¬í•œ ê°ì²´ë¥¼ clone ë©”ì„œë“œë¥¼ í†µí•´ ë³µì œí•  ìˆ˜ ìˆì„ê¹Œ?

ë°˜í™˜ëœ Stack ì¸ìŠ¤í„´ìŠ¤ì˜ size í•„ë“œëŠ” ì˜¬ë°”ë¥¸ ê°’ì„ ê°–ì§€ë§Œ, elements í•„ë“œëŠ” ì›ë³¸ Stack ì¸ìŠ¤í„´ìŠ¤ì™€ ë˜‘ê°™ì€ ë°°ì—´ì„ ì°¸ì¡°í•œë‹¤. ì›ë³¸ì´ë‚˜ ë³µì œë³¸ì´ ìˆ˜ì •ë˜ëŠ” ìˆœê°„ ë‹¤ë¥¸ í•˜ë‚˜ë„ í•¨ê»˜ ìˆ˜ì •ë˜ëŠ” ë¬¸ì œê°€ ìƒê¸°ê²Œ ë˜ëŠ” ê²ƒì´ë‹¤.

ë”°ë¼ì„œ, ìŠ¤íƒ ë‚´ë¶€ ì •ë³´ë¥¼ ë³µì‚¬ í•´ì•¼ í•œë‹¤.

```java
@Override public Stack clone() {
    try {
        Stack result = (Stack) super.clone();
        return result;
    } catch (CloneNotSupportedException e) {
        throw new AssertionError();
    }
}
```

## âœ¨ í•´ì‹œí…Œì´ë¸”ì—ì„œì˜ ë³µì œ

ì „ê³¼ ë˜‘ê°™ì´ cloneì„ ì¬ê·€ì ìœ¼ë¡œ í˜¸ì¶œí•˜ëŠ” ê²½ìš° ì›ë³¸ê³¼ ê°™ì€ ì—°ê²° ë¦¬ìŠ¤íŠ¸ë¥¼ ì°¸ì¡°í•˜ê²Œ ëœë‹¤. ë”°ë¼ì„œ í•´ì‹œ í…Œì´ë¸”ì˜ ê²½ìš° ê° ë²„í‚·ì„ êµ¬ì„±í•˜ëŠ” ì—°ê²° ë¦¬ìŠ¤íŠ¸ë¥¼ ë³µì‚¬í•´ì•¼ í•œë‹¤.

```java
public class HashTable implements Cloneable {
    private Entry[] buckets = ...;

    private static class Entry {
        final Object key;
        Object value;
        Entry next;

        Entry (Object key, Object value, Entry next) {
            this.key = key;
            this.value = value;
            this.next = next;
        }

        Entry deepCopy() {
            return new Entry(key, value, next == null? null : next.deepCopy());
        }
    }

    @Override public HashTable clone() {
        try {
            HashTable result = (HastTable) super.clone();
            result.buckets = new Entry[buckets.length];
            for (int i=0; i<buckets.length; i++) {
                if (buckets[i] != null)
                    result.buckets[i] = buckets[i].deepCopy();
            }
            return result;
        } catch (CloneNotSupportedException e) {
            throw new AssertionError();
        }
    }
}
```

í•´ë‹¹ ë²„í‚· ë°°ì—´ë§Œ cloneí•˜ëŠ” ê²ƒì´ ì•„ë‹Œ, ì—°ê²° ë¦¬ìŠ¤íŠ¸ê¹Œì§€ ë³µì œë¥¼ í•´ ì¤˜ì•¼ í•œë‹¤.

ê·¸ëŸ¬ë‚˜ ì¬ê·€ í˜¸ì¶œë¡œ ì¸í•´ ë¦¬ìŠ¤íŠ¸ì˜ ì›ì†Œ ìˆ˜ë§Œí¼ ìŠ¤íƒ í”„ë ˆì„ì„ ì†Œë¹„í•˜ì—¬, ë¦¬ìŠ¤íŠ¸ê°€ ê¸¸ë©´ ìŠ¤íƒ ì˜¤ë²„í”Œë¡œë¥¼ ì¼ìœ¼í‚¬ ìœ„í—˜ì´ ìˆë‹¤. ë”°ë¼ì„œ ì¬ê·€ í˜¸ì¶œ ëŒ€ì‹  ë°˜ë³µìë¥¼ ì¨ì„œ ìˆœíšŒí•˜ëŠ” ë°©í–¥ìœ¼ë¡œ ì½”ë“œë¥¼ ì§œì•¼ í•œë‹¤.

```java
Entry deepCopy() {
    Entry result = new Entry (key, value, next);
    for (Entry p = result; p.next != null; p= p.next)
        p.next = new Entry(p.next.key, p.next.value, p.next.next);
    return result;
}
```

## ğŸ«§ clone ì¬ì •ì˜ ì‹œ ì£¼ì˜ì‚¬í•­

1) ì¬ì •ì˜ë  ìˆ˜ ìˆëŠ” ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì§€ ë§ˆë¼.

    -> final or privateìœ¼ë¡œ ì„¤ì •í•´ ë³€ê²½ ê°€ëŠ¥ì„±ì„ ì—†ì• ë¼

2) ì‚¬ìš©ì˜ í¸ì˜ì„±ì„ ìœ„í•´ ì¬ì •ì˜í•œ ë©”ì„œë“œì—ì„œëŠ” ê²€ì‚¬ ì˜ˆì™¸ë¥¼ ë˜ì§€ì§€ ë§ˆë¼.
3) ìƒì†ìš© í´ë˜ìŠ¤ëŠ” Cloneableì„ êµ¬í˜„í•˜ì§€ ë§ˆë¼.
4) clone ë©”ì„œë“œë¥¼ ì¬ì •ì˜í•˜ê³  ë™ê¸°í™”í•´ì•¼ í•œë‹¤.


## ğŸ«§ ì •ë¦¬

Cloneableì„ êµ¬í˜„í•˜ëŠ” ëª¨ë“  í´ë˜ìŠ¤ëŠ” cloneì„ ì¬ì •ì˜í•´ë¼
    
    -> ì ‘ê·¼ ì œí•œìëŠ” publicìœ¼ë¡œ, ë°˜í™˜ íƒ€ì…ì€ í´ë˜ìŠ¤ ìì‹ ìœ¼ë¡œ ë³€ê²½

cloneì„ ì¬ì •ì˜í•  ì‹œ super.clone í˜¸ì¶œ í›„ ê°€ë³€ ê°ì²´ê¹Œì§€ ë³µì œë  ìˆ˜ ìˆë„ë¡ êµ¬í˜„í•´ë¼.

ë˜ëŠ” Cloneableì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ë³µì‚¬ ìƒì„±ìì™€ ë³µì‚¬ íŒ©í„°ë¦¬ë¥¼ êµ¬í˜„í•´ë¼.

ì—¬ê¸°ì„œ ë³µì‚¬ ìƒì„±ìë€ ë‹¨ìˆœíˆ ìì‹ ê³¼ ê°™ì€ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¸ìˆ˜ë¡œ ë°›ëŠ” ìƒì„±ìë¥¼ ë§í•œë‹¤.

# ğŸ“Œ ì°¸ê³ ìë£Œ
- [Cloneable ë©”ì„œë“œ](https://inpa.tistory.com/entry/JAVA-%E2%98%95-Object-%ED%81%B4%EB%9E%98%EC%8A%A4-clone-%EB%A9%94%EC%84%9C%EB%93%9C-%EC%96%95%EC%9D%80-%EB%B3%B5%EC%82%AC-%EA%B9%8A%EC%9D%80-%EB%B3%B5%EC%82%AC)