---
title: "[FS] κ°€μƒ λ””μ¤ν¬ μƒμ„±"
categories:
  - File Forensic
tags:
toc: true
toc_sticky: true
date: 2025-03-16 14:59:00 +0900
---

## π«§ 1. ν™κ²½ μ„Έν…

### β¨ 1.0 ν™κ²½ μ„¤μ •
- κ°€μƒλ¨Έμ‹  ν™μ©
  - λ””μ¤ν¬λ¥Ό κ³ μ • μ‚¬μ΄μ¦λ΅ κ³ μ • (λ™μ  ν• λ‹Ή X) : `Pre-allocate disk space`
  - SSD TRIM κΈ°λ¥ λΉ„ν™μ„±ν™”
  - μ¤λƒ…μƒ· κΈ°λ¥ λΉ„ν™μ„±ν™”
- **OS:** Ubuntu 22.04 LTS
- **FS:** ext4
- **Partition:** 4GB
- **File Type:** .jpg

### β¨ 1.1. ν„μ¬ λ””μ¤ν¬/νν‹°μ… μ΅°ν

> fdisk -l

<img width="1512" alt="image" src="https://github.com/user-attachments/assets/4ecc99c9-00f7-440a-a9d6-d923d660cdb4" />

μ‹¤μ  λ™μ‘ν•λ” ν•λ“λ””μ¤ν¬ ν™κ²½κ³Ό μ μ‚¬ν•κ² ν•λ ¤λ©΄ λ‹¤μκ³Ό κ°™μ€ λ°©μ‹μΌλ΅ μ§„ν–‰ν•λ©΄ λλ‹¤.

1. ddλ΅ κ°€μƒ λ””μ¤ν¬ μƒμ„±
2. losetupμ„ μ΄μ©ν•΄ λ£¨ν”„λ°± λ””λ°”μ΄μ¤λ΅ μ—°κ²° (/dev/loopN), Nμ€ μ–‘μλ¥Ό μλ―Έ

μ•„λμ—μ„ λ” μμ„Έν•κ² μ‚΄ν΄λ³΄μ.

### β¨ 1.2. ddλ΅ κ°€μƒ λ””μ¤ν¬ μƒμ„±

> dd if=/dev/zero of=test_disk.img bs=1M count=8192

: ddλ” μ €μμ¤€ λ³µμ‚¬ λ° λ³€ν™μ„ μ„ν• μ λ‹‰μ¤ κΈ°λ°μ λ…λ Ήμ–΄μ΄λ‹¤.

μ£Όλ΅ <strong>λ””μ¤ν¬ λ³µμ‚¬, νμΌ μ‹μ¤ν… μƒμ„±, λ³µμ‚¬λ³Έ μƒμ„±</strong> λ“±μ— μ“°μΈλ‹¤.

ν•΄λ‹Ή λ…λ Ήμ–΄λ¥Ό μμ„Έν•κ² λ³΄μ.

`if=/dev/zero`
- ifλ” μ…λ ¥ νμΌ(input file)μ„ μ§€μ •ν•λ‹¤.
- /dev/zero/ λ” λ¬΄ν•ν 0μΌλ΅ μ±„μ›μ§€λ” νΉμ νμΌμ΄λ‹¤. μ¦‰, 0x00μΌλ΅ κ°€λ“ μ°¬ λ¦¬λ…μ¤ μ¥μΉ νμΌμ΄λ‹¤. λ¶ν•„μ”ν• λ΅κ·Έ μ¶λ ¥ λ“±μ„ ν”Όν•κΈ° μ„ν•΄ nullλ΅ μ±„μ΄λ‹¤κ³  μƒκ°ν•λ©΄ μ΄ν•΄κ°€ μ‰½λ‹¤.

`of=test_disk.img`
- ofλ” μ¶λ ¥ νμΌ(output file)μ„ μ§€μ •ν•λ‹¤.
- test_disk.imgλ” μƒμ„±λ  κ°€μƒ λ””μ¤ν¬ νμΌλ…μΌλ΅, μ΄ νμΌμ— μ…λ ¥ νμΌμ—μ„ μ…λ ¥ν•΄μ£Όμ—λ 0x00μΌλ΅ κ°€λ“ μ°¬ λ°μ΄ν„°κ°€ μ €μ¥λλ‹¤.

`bs=1M`
- bsλ” λΈ”λ΅ ν¬κΈ°λ¥Ό μ§€μ •ν•΄μ¤€λ‹¤. (ν• λ²μ— μ½μ–΄λ“¤μΌ μ‚¬μ΄μ¦λ¥Ό μλ―Έ)
- 1Mμ€ 1MB ν¬κΈ°λ¥Ό μλ―Έν•λ©°, 1Gλ” 1GB λ°μ΄ν„°μ ν¬κΈ°λ¥Ό μλ―Έν•λ‹¤.

`count=100`
- countλ” λ‡ κ°μ λΈ”λ΅μ„ μ½κ³  μ“Έ κ±΄μ§€λ¥Ό μ§€μ •ν•λ‹¤.
- μ—¬κΈ°μ„ 100μ€ 100κ°μ λΈ”λ΅μ„ μ‚¬μ©ν•λ‹¤λ” μλ―Έμ΄λ‹¤.

κ°€μƒ λ””μ¤ν¬μ ν¬κΈ°λ” bs * count κ°’μ— μν•΄ κ²°μ •λλ‹¤.

λ”°λΌμ„, ν„μ¬ bs=1M, count=100μ΄λ―€λ΅ μµμΆ… ν¬κΈ°λ” 100MBκ°€ λ  κ²ƒμ΄λ‹¤.

κ·Έλ¬λ‚ μ°λ¦¬λ” 8GBλ΅ μ„Έν…μ„ ν•  μμ •μ΄κΈ° λ•λ¬Έμ—, bs=1M, count=8192λ΅ μ„Έν…ν•  κ²ƒμ΄λ‹¤.

!!! λ„λ¬΄ λ§μ΄ μ΅μΌλ©΄ μ €μ¥ κ³µκ°„μ΄ λ¶€μ΅±ν•λ‹¤...

### β¨ 1.3. losetup

> sudo losetup -fP test_disk.img

λ£¨ν”„λ°± λ””λ°”μ΄μ¤λ΅ μ—°κ²°

#### βοΈ λ£¨ν”„λ°± λ””λ°”μ΄μ¤ (loopback device)

: λ£¨ν”„λ°± μ¥μΉλ” νμΌμ„ κ°€μƒ λ””μ¤ν¬μ²λΌ μ‚¬μ©ν•  μ μκ² ν•΄ μ£Όλ” μ¥μΉμ΄λ‹¤.

μ¦‰, λ£¨ν”„λ°± μ¥μΉλ¥Ό μ΄μ©ν•λ©΄ μ•μ„ ddλ΅ λ§λ“  λ””μ¤ν¬ μ΄λ―Έμ§€ νμΌ(.img, .iso)μ„ μ‹¤μ  ν•λ“λ””μ¤ν¬μ²λΌ νν‹°μ…μ„ λ‚λ„κ³  ν¬λ§·ν•λ” λ“±μ μ‘μ—…μ„ κ±°μΉ  μ μκ² λλ‹¤.

λ°”λ΅ νν‹°μ…μ„ λ§λ“¤μ§€ μ•λ” μ΄μ λ„ μ΄ λ•λ¬ΈμΈλ°, λ””μ¤ν¬ μ΄λ―Έμ§€ νμΌμ„ μ‹¤μ  λ””μ¤ν¬μ²λΌ λ‹¤λ£¨κΈ° μ„ν•΄μ„λ” λ£¨ν”„λ°± λ””λ°”μ΄μ¤κ°€ κΌ­ ν•„μ”ν•λ‹¤λ” κ²ƒμ΄ κ·Έ μ΄μ λ‹¤.

`-f`
- μ‚¬μ© κ°€λ¥ν• μ²« λ²μ§Έ λ£¨ν”„λ°± μ¥μΉλ¥Ό μλ™μΌλ΅ μ°Ύμ•„μ„ μ„¤μ •ν•λ” μµμ…
- λ£¨ν”„λ°± μ¥μΉ(/dev/loop0, /dev/loop1 λ“±) μ—¬λ¬ κ°κ°€ μμ„ μ μκΈ° λ•λ¬Έμ— -f μµμ…μ„ μ‚¬μ©ν•΄ λΉ λ£¨ν”„λ°± λ””λ°”μ΄μ¤λ¥Ό μ°Ύμ•„μ£Όμ–΄μ•Ό ν•λ‹¤.
- λ§μΌ μ΄ μµμ…μ„ μ‚¬μ©ν•μ§€ μ•λ”λ‹¤λ©΄ μ§μ ‘ λ£¨ν”„λ°± λ””λ°”μ΄μ¤λ¥Ό μ§€μ •ν•΄ μ£Όλ” λ°©λ²•λ„ μλ‹¤.
<br/> => ex) losetup /dev/loop0 virtual_disk.img

`-P`
- λ£¨ν”„λ°± λ””λ°”μ΄μ¤μ— μ—°κ²°λ λ””μ¤ν¬ μ΄λ―Έμ§€ μ•μ— μλ” νν‹°μ…μ„ μλ™μΌλ΅ κ°μ§€ν•μ—¬ μ„¤μ •ν•λ” μµμ…

![image](https://github.com/user-attachments/assets/f6d2418e-4306-4d38-b5a5-0def5b61eaa3)

- μ‹¤μ  λ””μ¤ν¬ λ‚΄ νν‹°μ…μ΄ μ—¬λ¬ κ°μΌ μ μμΌλ―€λ΅, -P μµμ…μ„ μ‚¬μ©ν•΄ λ‚΄λ¶€μ— μλ” νν‹°μ…μ„ μλ™μΌλ΅ ν• λ‹Ήν•΄μ•Ό ν•λ‹¤.
- π’΅ λ‹¤λ§, λ¨λ“  μ„Έν…μ΄ μ™„λ£λ ν›„ νν‹°μ…μ„ μ¶”κ°€ν•λ ¤κ³  ν•  λ•λ” μλ™ ν• λ‹Ήμ΄ λμ§€ μ•μΌλ―€λ΅ λ‹¤μ‹ μ΄ λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•κ±°λ‚ λ‹¤λ¥Έ λ°©λ²•μΌλ΅ νν‹°μ…μ„ ν• λ‹Ήν•΄μ¤μ•Ό ν•¨μ„ μμ§€ λ§μ!


### β¨ 1.4. fdiskλ΅ νν‹°μ… λ§λ“¤κΈ°

> sudo fdisk -l

μ•„κΉ μƒμ„±λ λ””μ¤ν¬λ¥Ό ν™•μΈν•μ.

<img width="1136" alt="image" src="https://github.com/user-attachments/assets/7b6701c3-8f0f-4525-aad7-0b89126026ba" />

/dev/loop8λ΅ μ΄λ―Έμ§€κ°€ μ λ“¤μ–΄κ°„ λ¨μµμ΄λ‹¤!

μ΄μ  λ§λ“¤μ–΄μ§„ κ°€μƒ λ””μ¤ν¬λ΅ νν‹°μ…μ„ λ§λ“¤ μ°¨λ΅€μ΄λ‹¤.

> sudo fdisk /dev/loop8

<img width="661" alt="image" src="https://github.com/user-attachments/assets/b5f0d7ed-2f75-4ff3-91fd-5fa4c6fcafa7" />

Command μ°½μ΄ λ– λ„ λ†€λΌμ§€ λ§ κ²ƒ.. (fdisk μ ν‹Έλ¦¬ν‹° μ‹μ‘)

<img width="735" alt="image" src="https://github.com/user-attachments/assets/9031935d-9c11-4f94-bc00-388e3349b989" />

1. `n` : μƒ νν‹°μ… μƒμ„±
2. `p` : κΈ°λ³Έ νν‹°μ… μ„ νƒ
<br/> -> μ΄ λν• κΈ°λ³Έκ°’μΌλ΅ 1μ„ μ„ νƒν•΄μ¤€λ‹¤.

3. `enter` : μ²μ μ„Ήν„° μ„¤μ • (λ³€κ²½ν•  ν•„μ” μ—†μ)
3. `enter` : λ μ„Ήν„° μ„¤μ • (λ³€κ²½ν•  ν•„μ” μ—†μ)
4. `w` : λ³€κ²½μ‚¬ν•­ μ €μ¥
5. fdisk μΆ…λ£

κ·Έλ¦¬κ³  λ‹¤μ‹ `sudo fdisk -l` λ…λ Ήμ–΄λ΅ ν™•μΈν•΄λ³΄λ©΄ νν‹°μ…μ΄ μ λ€λ΅ λ“¤μ–΄κ°”μμ„ ν™•μΈν•  μ μλ‹¤.

<img width="539" alt="image" src="https://github.com/user-attachments/assets/04cb1095-d5b2-4aa0-9c1a-ac71cf2aef12" />

### β¨ 1.5. νμΌ μ‹μ¤ν… μƒμ„± & λ§μ΄νΈ

μ΄μ  μ°λ¦¬κ°€ λ§λ“  μ¥μΉλ¥Ό μ‚¬μ©ν•κΈ° μ„ν•΄ λ§μ΄νΈ(mount)λ¥Ό ν•  μ°¨λ΅€μ΄λ‹¤.

#### π’΅ mount : νΉμ • λ””λ°”μ΄μ¤λ¥Ό μ‚¬μ©ν•κΈ° μ„ν•΄ ν•λ“μ›¨μ–΄ μ¥μΉμ™€ νΉμ • λ””λ ‰ν„°λ¦¬λ¥Ό μ—°κ²°ν•λ” μ‘μ—…

μ°λ¦¬κ°€ λ§λ“  μ¥μΉλ” λ””μ¤ν¬ μ΄λ―Έμ§€λ΅, μ‹¤μ  ν•λ“μ›¨μ–΄ μ¥μΉλ” μ•„λ‹μ§€λ§ λ£¨ν”„λ°±μ„ ν†µν•΄ μ‹¤μ  ν•λ“μ›¨μ–΄ μ¥μΉμ²λΌ μ‚¬μ© κ°€λ¥ν•κ² ν•΄ μ£Όμ—μΌλ―€λ΅ λ§μ΄νΈ λν• κ·Έλ€λ΅ μ§„ν–‰ν•΄μ£Όλ©΄ λ¬Έμ  μ—†μ΄ λλ‹¤!!

> df -h
: λ§μ΄νΈ μƒνƒ ν™•μΈ λ…λ Ήμ–΄

μ•„κΉ μ „ ν™•μΈν• μ°λ¦¬μ νν‹°μ… μ΄λ¦„μ€ loop8p1μ΄μ—λ‹¤. (μ‚¬μ§„ λ§μ§€λ§‰ ν™•μΈ)

<img width="539" alt="image" src="https://github.com/user-attachments/assets/04cb1095-d5b2-4aa0-9c1a-ac71cf2aef12" />


λ”°λΌμ„, μ°λ¦¬λ” μ°λ¦¬κ°€ λ§λ“  λ””μ¤ν¬ λ‚΄ ext4λ΅ νμΌ μ‹μ¤ν…μ„ μ„¤μ •ν•κΈ° μ„ν•΄ λ‹¤μκ³Ό κ°™μ€ λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•  μμ •μ΄λ‹¤.

> sudo mkfs.ext4 /dev/loop8p1

<img width="622" alt="image" src="https://github.com/user-attachments/assets/4b3428b0-d0e7-4ff0-a602-38a2523ba33d" />


- fdiskλ΅ μƒμ„±ν• νν‹°μ…(/dev/loop8p1) μ— ext4 νμΌ μ‹μ¤ν…μ„ μƒμ„±ν•λ” λ…λ Ήμ–΄

> sudo mkdir /mnt/test_disk

- λ§μ΄νΈν•  λ””λ ‰ν„°λ¦¬ μƒμ„±
- λ¦¬λ…μ¤λ” νμΌ μ‹μ¤ν…μ„ λ§μ΄νΈν•  λ• λ§μ΄νΈ ν¬μΈνΈλΌλ” λ””λ ‰ν„°λ¦¬κ°€ ν•„μ”ν•λ‹¤.
- μ΄ λ””λ ‰ν„°λ¦¬λ” μ°λ¦¬κ°€ λ§λ“  λ””μ¤ν¬μ™€ νμΌ μ‹μ¤ν…μ„ μ—°κ²°ν•  μ„μΉκ°€ λλ‹¤.

> sudo mount /dev/loop8p1 /mnt/test_disk

- νν‹°μ…(/dev/loop8p1)μ„ κΈ°μ΅΄μ— λ§λ“  λ””λ ‰ν„°λ¦¬(/mnt/test_disk)μ— λ§μ΄νΈν•λ” λ…λ Ήμ–΄

λ‹¤μ‹ `df -h`λ΅ λ§μ΄νΈ μ—¬λ¶€λ¥Ό ν™•μΈν•΄λ³΄λ©΄ λ‹¤μκ³Ό κ°™μ΄ μ°λ¦¬κ°€ λ§λ“  λ””μ¤ν¬κ°€ μ •μƒμ μΌλ΅ λ§μ΄νΈλμ—μμ„ μ• μ μλ‹¤.

<img width="691" alt="image" src="https://github.com/user-attachments/assets/31f54428-93bc-4e60-a5d9-59735ea41451" />


μ΄μ  /mnt/test_disk κ²½λ΅μ—μ„ νμΌ μƒμ„± λ° μ‚­μ  ν…μ¤νΈλ¥Ό μ§„ν–‰ν•  μ μλ‹¤.

### β¨ SSD TRIM κΈ°λ¥ λΉ„ν™μ„±ν™”

1. sudo vim /etc/fstab
<br/>-> etc/fstab νμΌμ—μ„ ν•΄λ‹Ή λ””μ¤ν¬(/dev/loop8, /mnt/test_disk)μ discard μµμ…μ„ μ κ±°ν•λ‹¤.

2. /dev/loop8p1 /mnt/test_disk ext4 defaults 0 2

μ—¬κΈ°μ„ defaults μµμ…μ€ λ‹¤μκ³Ό κ°™μ΄ κµ¬μ„±λλ‹¤.

- rw (μ½κΈ°/μ“°κΈ° λ¨λ“)
- suid (set-user-identifier bits)
- dev (λ””λ°”μ΄μ¤ νμΌμ„ μ‚¬μ©)
- exec (μ‹¤ν–‰ κ°€λ¥ νμΌμ„ μ‚¬μ©)
- auto (μλ™ λ§μ΄νΈ)
- nouser (μ‚¬μ©μκ°€ λ§μ΄νΈν•  μ μ—†μ)
- async (λΉ„λ™κΈ°μ μΌλ΅ νμΌ μ‹μ¤ν… μ‘μ—…)

μ—¬κΈ°μ„ μμ„Έν•κ² λ΄μ•Ό ν•  μ μ€, default μµμ…μ΄ discard μµμ…μ„ ν¬ν•¨ν•μ§€ μ•λ”λ‹¤λ” μ μ΄λ‹¤.

discard μµμ…μ΄ μΌμ Έ μμΌλ©΄ trimμ΄ ν™μ„±ν™”λκΈ° λ•λ¬Έμ— defaults μµμ…μ„ μΌμ„ trimμ„ λΉ„ν™μ„±ν™” ν•΄μ¤„ μ μκΈ° λ•λ¬Έμ— trimμ„ λΉ„ν™μ„±ν™”μ‹ν‚¤κΈ° μ„ν•΄μ„λ” λ‹¤μκ³Ό κ°™μ€ /etc/fstab νμΌμ— ν•΄λ‹Ή λ””μ¤ν¬μ μµμ…μ„ defaultλ΅ μ£Όλ©΄ λλ‹¤.

3. μ¬λ¶€ν… or λ‹¤μ‹ λ§μ΄νΈν•κΈ°

- μμ • ν›„ λ³€κ²½ μ‚¬ν•­μ„ μ μ©ν•κΈ° μ„ν•΄μ„λ” μ¬λ¶€ν…ν•κ±°λ‚ λ‹¤μ‹ λ§μ΄νΈλ¥Ό ν•΄μ•Ό ν•λ‹¤.
```
- sudo reboot (μ¬λ¶€ν…)

λλ”

- sudo umount /mnt/test_disk
- sudo mount /dev/loop8p1 /mnt/test_disk
```

4. trim κΈ°λ¥ λΉ„ν™μ„±ν™” ν™•μΈ

> sudo tune2fs -l /dev/loop8p1 | grep "Filesystem features"

μ΄λ• has_journalκ³Ό ext_attr λ“±μ΄ λ‚μ¬ μ μμΌλ©°, μ—¬κΈ°μ— trim κ΄€λ ¨ ν•­λ©μ΄ μ—†λ‹¤λ©΄ ν•΄λ‹Ή λ””μ¤ν¬μ—μ„λ” Trimμ΄ λΉ„ν™μ„±ν™”λμ—μμ„ μ• μ μλ‹¤.

`unmount`κ°€ μ•„λ‹λΌ `umout`μ΄λ‹¤...

### β¨ μ¤λƒ…μƒ· κΈ°λ¥ λΉ„ν™μ„±ν™”

### β¨ cf) κ°€μƒ λ””μ¤ν¬ μ κ±°

> umount /mnt/test_disk
> losetup -d /dev/loop0