---
title: "[FS] íŒŒì¼ ìƒì„± ë° ì‚­ì œ ê³¼ì • ë¶„ì„"
categories:
  - File Forensic
tags:
toc: true
toc_sticky: true
date: 2025-03-18 08:02:00 +0900
---

## ğŸ«§ ìŠ¤í¬ë¦½íŠ¸ ìë™í™” í™˜ê²½ êµ¬ì¶•

1. bash ìŠ¤í¬ë¦½íŠ¸ë¥¼ í†µí•´ íŒŒì¼ ìƒì„± ë° ì‚­ì œ íŠ¸ë¦¬ê±° ìë™í™”

```bash
#!/bin/bash

# í˜„ì¬ ìœ„ì¹˜ì—ì„œ íŠ¸ë¦¬ê±°ë˜ë„ë¡ ì„¤ì •
WATCH_DIR="."

# ìƒì„± ë° ì‚­ì œ ì‹œ íŠ¸ë¦¬ê±°
inotifywait -m -e create -e delete --format '%w%f %e' "$WATCH_DIR" | while read FILE EVENT
do
    # íŒŒì¼ ìƒì„± ì‹œ íŠ¸ë¦¬ê±° 
    if [[ "$EVENT" == "CREATE" ]]; then
        echo "event trigger: $EVENT $FILE" | tee -a "$LOG_FILE"

        # íŒŒì¼ ë©”íƒ€ë°ì´í„° ì¶œë ¥
        stat "$FILE" | tee -a "$LOG_FILE"

        # íŒŒì¼ í—¤ë”(ì‹œê·¸ë‹ˆì²˜) ë¶„ì„
        xxd -l 16 "$FILE" | tee -a "$LOG_FILE" # ì²˜ìŒ 16ë°”ì´íŠ¸ë§Œ ì¶œë ¥ (íŒŒì¼ ì‹œê·¸ë‹ˆì²˜ í™•ì¸)

        # íŒŒì¼ íƒ€ì… í™•ì¸
        file "$FILE" | tee -a "$LOG_FILE"

    # íŒŒì¼ ì‚­ì œ ì‹œ íŠ¸ë¦¬ê±°
    elif [[ "$EVENT" == "DELETE" ]]; then
        echo "Delete File: $FILE" | tee -a "$LOG_FILE"
    fi
done
```

![image](https://github.com/user-attachments/assets/560311d2-9515-486d-98c9-c88d93a13125)



2. chmod +x test.bash : ì‹¤í–‰ ê¶Œí•œ ì£¼ê¸° 

3. ./test.bash & : ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰

![image](https://github.com/user-attachments/assets/642bdb72-71f1-4d18-88c9-5ebe2a1a1fb9)

### âœ¨ ì˜µì…˜
| ì˜µì…˜               | ì„¤ëª…                                              |
|--------------------|---------------------------------------------------|
| `-m`               | ì§€ì†ì ìœ¼ë¡œ ê°ì‹œ (monitor)                        |
| `-e <ì´ë²¤íŠ¸>`      | íŠ¹ì • ì´ë²¤íŠ¸ë§Œ ê°ì‹œ                                 |
| `-r`               | ë””ë ‰í„°ë¦¬ ë‚´ë¶€ì˜ í•˜ìœ„ í´ë”ê¹Œì§€ ê°ì‹œ (recursive)     |
| `-q`               | ë¶ˆí•„ìš”í•œ ì¶œë ¥ ì œê±° (quiet)                         |
| `--format '<í˜•ì‹>'` | ì¶œë ¥ í˜•ì‹ ì§€ì •                                     |
| `--timeout <ì´ˆ>`    | ì§€ì •í•œ ì‹œê°„ í›„ ìë™ ì¢…ë£Œ                          |

### âœ¨ ì´ë²¤íŠ¸ ì¢…ë¥˜
| ì´ë²¤íŠ¸        | ì„¤ëª…                                               |
|---------------|----------------------------------------------------|
| `access`      | íŒŒì¼ì´ ì½í ë•Œ (ì˜ˆ: `cat file.txt`)                |
| `modify`      | íŒŒì¼ì´ ìˆ˜ì •ë  ë•Œ                                   |
| `attrib`      | íŒŒì¼ ì†ì„±ì´ ë³€ê²½ë  ë•Œ (ì˜ˆ: `chmod`, `chown` ë“±)   |
| `close_write` | íŒŒì¼ì´ ì“°ê¸° ëª¨ë“œì—ì„œ ë‹«í ë•Œ                      |
| `close_nowrite`| íŒŒì¼ì´ ì½ê¸° ëª¨ë“œì—ì„œ ë‹«í ë•Œ                    |
| `create`      | íŒŒì¼ ë˜ëŠ” ë””ë ‰í„°ë¦¬ê°€ ìƒì„±ë  ë•Œ                    |
| `delete`      | íŒŒì¼ ë˜ëŠ” ë””ë ‰í„°ë¦¬ê°€ ì‚­ì œë  ë•Œ                    |
| `delete_self` | ê°ì‹œ ì¤‘ì¸ íŒŒì¼ì´ ì‚­ì œë  ë•Œ                        |
| `move_self`   | ê°ì‹œ ì¤‘ì¸ íŒŒì¼ì´ ì´ë™ë  ë•Œ                        |
| `moved_from`  | íŒŒì¼ì´ ë‹¤ë¥¸ ê³³ìœ¼ë¡œ ì´ë™ë  ë•Œ (ì˜ë ¤ë‚˜ê°)           |
| `moved_to`    | íŒŒì¼ì´ ì´ë™ë˜ì–´ ë“¤ì–´ì˜¬ ë•Œ                         |
| `open`        | íŒŒì¼ì´ ì—´ë¦´ ë•Œ                                     |


í˜„ì¬ ì–´ë””ì— ë§ˆìš´íŠ¸ë˜ì—ˆëŠ”ì§€ ì•Œê³  ì‹¶ë‹¤ë©´ `df .` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

### âœ¨ raw ì´ë¯¸ì§€ ìƒì„±

sudo dd if=/dev/sdX of=/path/to/output.img bs=4M status=progress


## ğŸ«§ íŒŒì¼ ìƒì„± ê³¼ì • ë¶„ì„ 

## ğŸ«§ íŒŒì¼ ì‚­ì œ ê³¼ì • ë¶„ì„

## ğŸ«§ fstrim ì‚­ì œ ê³¼ì • ë¶„ì„

ì‚­ì œ ì „ íŒŒì¼ ë¦¬ìŠ¤íŠ¸ì™€ ì‚­ì œ í›„ íŒŒì¼ ë¦¬ìŠ¤íŠ¸ë¥¼ ë¹„êµí•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

fstrim ë„ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì…ë ¥í•˜ë©´ ëœë‹¤.

> systemctl disable fstrim.timer

```bash
#!/bin/bash

# ë””ìŠ¤í¬ì™€ ë§ˆìš´íŠ¸ í¬ì¸íŠ¸ ì„¤ì •
MOUNT_POINT="/mnt/test_disk"
DEVICE="/dev/loop3p1"

# fstrim í™œì„±í™” ì „ ìƒíƒœ í™•ì¸ (ì‚­ì œëœ íŒŒì¼ ì°¾ê¸°)
echo "before strim"
sudo debugfs $DEVICE -R "lsdel" > deleted_before.txt
echo "Save delete file list"

# fstrim ì‹¤í–‰
echo "Start fstrim"
sudo fstrim $MOUNT_POINT
echo "Finish fstrim"

# fstrim í™œì„±í™” í›„ ìƒíƒœ í™•ì¸ (ì‚­ì œëœ íŒŒì¼ ì°¾ê¸°)
echo "Check State"
sudo debugfs $DEVICE -R "lsdel" > deleted_after.txt

# ì°¨ì´ì  ë¶„ì„
echo "before vs after"
diff deleted_before.txt deleted_after.txt

```


<img width="681" alt="image" src="https://github.com/user-attachments/assets/29d6dbea-66ec-467e-920d-43f25e061c2e" />

<img width="310" alt="image" src="https://github.com/user-attachments/assets/36bc0dfe-420b-4191-826c-53d7bf1b886a" />

sudo dd if=/dev/nvme0n1p2 of=/mnt/hgfs/'File System'/test.dd bs=4M count=1024

mount mnt/hgfs/'File System'

sleuthkit? ë„êµ¬ â†’ blkcat ì´ë¯¸ì§€ íŒŒì¼ê³¼ íŒŒë¼ë§ˆí‹°ë¥¼ ë„£ì–´ íŠ¹ì • ìœ„ì¹˜ë¥¼ ì•Œ ìˆ˜ ìˆìŒ. blkls (í• ë‹¹/ë¹„í• ë‹¹ ì˜ì—­ ë³´ì—¬ì¤Œ)